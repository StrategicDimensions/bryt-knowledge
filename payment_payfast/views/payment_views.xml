<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <record id="acquirer_form_payfast" model="ir.ui.view">
            <field name="name">acquirer.form.payfast</field>
            <field name="model">payment.acquirer</field>
            <field name="inherit_id" ref="payment.acquirer_form"/>
            <field name="arch" type="xml">
                <xpath expr='//group[@name="acquirer"]' position='after'>
                    <group attrs="{'invisible': [('provider', '!=', 'payfast')]}">
                        <group>
                            <field name='merchant_key' password="True"/>
                            <field name="merchant_id" password="True"/>
                        </group><br/><br/><br/>
                    </group>
                </xpath>
            </field>
        </record>
        <record id="transaction_form_mygate" model="ir.ui.view">
            <field name="name">acquirer.transaction.form.mygate</field>
            <field name="model">payment.transaction</field>
            <field name="inherit_id" ref="payment.transaction_form"/>
            <field name="arch" type="xml">
                <xpath expr='//form/sheet/group' position='after'>
                    <notebook>
                        <page string="Payfast TX Details" attrs="{'invisible': [('provider', '!=', 'payfast')]}">
                            <group>
                                <field name="payfast_txn_id"/>
                            </group>
                        </page>
                        <page string="Request" groups="base.group_no_one" attrs="{'invisible': [('provider', '!=', 'payfast')]}">
                            <group>
                                <field name="request_payload"/>
                            </group>
                        </page>
                        <page string="Response" groups="base.group_no_one" attrs="{'invisible': [('provider', '!=', 'payfast')]}">
                            <group>
                                <field name="response_payload"/>
                            </group>
                        </page>
                    </notebook>
                </xpath>
            </field>
        </record>

        <template id="website_sale.total">
            <div id="cart_total" t-att-class="extra_class or ''" t-if="website_sale_order and website_sale_order.website_order_line">
                <table class="table">
                      <tr id="empty">
                          <t t-if='not no_rowspan'><td rowspan="10" class="border-0"/></t>
                          <td class="col-md-2 col-3 border-0"></td>
                          <td class="col-md-2 col-3 border-0" ></td>
                      </tr>
                      <tr id="order_total_untaxed">
                          <td class="text-right border-0">Subtotal:</td>
                          <td class="text-xl-right border-0" >
                              <span t-field="website_sale_order.amount_untaxed" class="monetary_field" style="white-space: nowrap;" t-options="{'widget': 'monetary', 'display_currency': website_sale_order.currency_id}"/>
                          </td>
                      </tr>
                      <tr id="order_total_taxes">
                          <td class="text-right border-0">Taxes:</td>
                          <td class="text-xl-right border-0">
                               <span t-field="website_sale_order.amount_tax" class="monetary_field" style="white-space: nowrap;" t-options="{'widget': 'monetary', 'display_currency': website_sale_order.currency_id}" />
                          </td>
                      </tr>
                      <tr id="order_total">
                          <td class="text-right"><strong>Total:</strong></td>
                          <td class="text-xl-right">
                              <strong t-field="website_sale_order.amount_total" class="monetary_field"
                                  t-options='{"widget": "monetary", "display_currency": website_sale_order.pricelist_id.currency_id}'/>
                          </td>
                      </tr>
                    <t t-set="currency_ids" t-value="request.env['res.currency'].sudo().search([('id','!=', website_sale_order.pricelist_id.currency_id.id),('active','=',True)])"/>
                    <t t-foreach="currency_ids" t-as="cnr">
                        <tr id="order_total">
                          <td class="text-right"><strong>Total</strong>(<t t-esc="cnr.symbol"/>):</td>
                          <td class="text-xl-right">
                              <t t-set="value" t-value="cnr.sudo()._compute(website_sale_order.pricelist_id.currency_id, cnr, website_sale_order.amount_total,True)"/>
                              <strong t-esc="value" class="monetary_field"
                                  t-options='{"widget": "monetary", "display_currency": cnr}'/>
                          </td>
                      </tr>
                    </t>
                </table>
            </div>
    </template>

    <template id="website_sale.confirmation">
        <t t-call="website.layout">
            <t t-set="additional_title">Shop - Confirmed</t>
            <div id="wrap">
                <div class="container oe_website_sale py-2">
                    <h1><span>Order</span> <em t-field="order.name" /> <t t-if="order.state == 'sale'"><span>Confirmed</span></t></h1>

                    <div class="row">
                        <div class="col-12 col-xl">
                            <div class="oe_cart">
                                <t t-set="payment_tx_id" t-value="order.get_portal_last_transaction()"/>
                                <t t-if="payment_tx_id.state == 'done'">
                                    <div class="thanks_msg">
                                        <h2>Thank you for your order.
                                            <a role="button" class="btn btn-primary d-none d-md-inline-block" href="/shop/print" target="_blank" aria-label="Print" title="Print"><i class="fa fa-print"></i> Print</a>
                                        </h2>
                                    </div>
                                </t>
                                <t t-if="request.env['res.users']._get_signup_invitation_scope() == 'b2c' and request.website.is_public_user()">
                                    <p class="alert alert-info mt-3" role="status">
                                        <a role="button" t-att-href='order.partner_id.signup_prepare() and order.partner_id.with_context(relative_url=True).signup_url' class='btn btn-primary'>Sign Up</a>
                                         to follow your order.
                                    </p>
                                </t>
                                <div class="oe_structure clearfix mt-3" id="oe_structure_website_sale_confirmation_1"/>
                                <h3 class="text-left mt-3">
                                    <strong>Payment Information:</strong>
                                </h3>
                                <table class="table">
                                    <tbody>
                                        <tr>
                                            <td colspan="2">
                                                <t t-esc="order.get_portal_last_transaction().acquirer_id.name" />
                                            </td>
                                            <td class="text-right" width="100">
                                                <strong>Total:</strong>
                                            </td>
                                            <td class="text-right" width="100">
                                                <strong t-field="order.amount_total" t-options="{'widget': 'monetary', 'display_currency': order.pricelist_id.currency_id}" />
                                            </td>
                                        </tr>
                                        <t t-set="currency_ids" t-value="request.env['res.currency'].sudo().search([('id','!=', order.pricelist_id.currency_id.id),('active','=',True)])"/>
                                        <t t-foreach="currency_ids" t-as="cnr">
                                            <tr>
                                              <td colspan="2"><t t-esc="order.get_portal_last_transaction().acquirer_id.name" /></td>
                                              <td class="text-right"><strong>Total</strong>(<t t-esc="cnr.symbol"/>):</td>
                                              <td class="text-xl-right">
                                                  <t t-set="value" t-value="cnr.sudo()._compute(order.pricelist_id.currency_id, cnr, order.amount_total,True)"/>
                                                  <strong t-esc="value" class="monetary_field"
                                                      t-options='{"widget": "monetary", "display_currency": cnr}'/>
                                              </td>
                                          </tr>
                                        </t>
                                    </tbody>
                                </table>
                                <t t-call="website_sale.payment_confirmation_status"/>
                                <div class="card mt-3">
                                  <div class="card-body">
                                    <t t-set="same_shipping" t-value="bool(order.partner_shipping_id==order.partner_id or only_services)" />
                                    <div><b>Billing <t t-if="same_shipping and not only_services"> &amp; Shipping</t>: </b><span t-esc='order.partner_id' t-options="dict(widget='contact', fields=['address'], no_marker=True, separator=', ')" class="address-inline"/></div>
                                    <div t-if="not same_shipping and not only_services" groups="sale.group_delivery_invoice_address"><b>Shipping: </b><span t-esc='order.partner_shipping_id' t-options="dict(widget='contact', fields=['address'], no_marker=True, separator=', ')"  class="address-inline"/></div>
                                  </div>
                                </div>
                                <div class="oe_structure mt-3" id="oe_structure_website_sale_confirmation_2"/>
                            </div>
                        </div>
                        <div class="col-12 col-xl-auto">
                            <t t-set="website_sale_order" t-value="order"/>
                            <t t-call="website_sale.cart_summary">
                                <t t-set="hide_coupon" t-value="1"/>
                            </t>
                        </div>
                    </div>
                </div>
                <div class="oe_structure" id="oe_structure_website_sale_confirmation_3"/>
            </div>
        </t>
    </template>

    </data>
</odoo>
